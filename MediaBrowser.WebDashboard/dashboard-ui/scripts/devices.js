define(["loading","dom","libraryMenu","globalize","humanedate","emby-linkbutton","emby-itemscontainer","cardStyle"],function(loading,dom,libraryMenu,globalize){"use strict";function deleteDevice(page,id){var msg=globalize.translate("DeleteDeviceConfirmation");require(["confirm"],function(confirm){confirm({text:msg,title:globalize.translate("HeaderDeleteDevice"),confirmText:globalize.translate("ButtonDelete"),primary:"cancel"}).then(function(){loading.show(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Devices",{Id:id})}).then(function(){loadData(page)})})})}function load(page,devices){var html="";html+=devices.map(function(device){var deviceHtml="";return deviceHtml+="<div data-id='"+device.Id+"' class='card backdropCard'>",deviceHtml+='<div class="cardBox visualCardBox">',deviceHtml+='<div class="cardScalable">',deviceHtml+='<div class="cardPadder cardPadder-backdrop"></div>',deviceHtml+='<div class="cardContent cardImageContainer">',device.ImageUrl?(deviceHtml+='<div class="cardImage coveredImage" style="background-image:url(\''+device.ImageUrl+"');\">",deviceHtml+="</div>"):deviceHtml+='<i class="cardImageIcon md-icon">tablet_android</i>',deviceHtml+="</div>",deviceHtml+="</div>",deviceHtml+='<div class="cardFooter">',deviceHtml+='<div style="text-align:right; float:right;padding-top:5px;">',deviceHtml+='<button type="button" is="paper-icon-button-light" data-id="'+device.Id+'" title="'+globalize.translate("ButtonDelete")+'" class="btnDeleteDevice autoSize"><i class="md-icon">delete</i></button>',deviceHtml+="</div>",deviceHtml+="<div class='cardText'>",deviceHtml+=device.Name,deviceHtml+="</div>",deviceHtml+="<div class='cardText cardText-secondary'>",deviceHtml+=device.AppName+" "+device.AppVersion,deviceHtml+="</div>",deviceHtml+="<div class='cardText cardText-secondary'>",device.LastUserName&&(deviceHtml+=device.LastUserName,deviceHtml+=", "+humane_date(device.DateLastActivity)),deviceHtml+="&nbsp;",deviceHtml+="</div>",deviceHtml+="</div>",deviceHtml+="</div>",deviceHtml+="</div>"}).join(""),page.querySelector(".devicesList").innerHTML=html}function loadData(page){loading.show(),ApiClient.getJSON(ApiClient.getUrl("Devices")).then(function(result){load(page,result.Items),loading.hide()})}return function(view,params){view.querySelector(".devicesList").addEventListener("click",function(e){var btnDelete=dom.parentWithClass(e.target,"btnDeleteDevice");btnDelete&&deleteDevice(view,btnDelete.getAttribute("data-id"))}),view.addEventListener("viewshow",function(){loadData(this)})}});